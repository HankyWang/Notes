# 计算机组成原理 #

----------
## 第四章 指令系统 ##
### 4.1 指令系统发展 ###
CISC(Complex Instructions Set Computing) 复杂指令集

RISC(Reduced Instructions Set Computing) 精简指令集

从CISC到RISC的转变：缺乏大内存储存复杂指令、指令形式或长度不统一、寄存器数量少

### 4.2 指令形式 ###
操作码+地址：操作码对应一种指令形式；地址码可以有多个。 指令的长度可以不一致。

访问内存的指令为SS指令，访问寄存器的指令为RR指令，两者结合为RS指令。

### 4.3 操作数类型 ###
**一般的数据类型：**

地址数据：地址看做无符号数；

数值数据：1.定点数；2.浮点数；3.压缩进制数

字符数据：采用ASCII码，7位有效位，最后一位奇偶校验位

逻辑数据：由若干二进制数表示。

### 4.4 指令寻址方式 ###

顺序寻址与跳跃寻址两种，前者使用PC进行计数，后者使用偏移量跳转。

**操作数基本寻址方式**

1. 隐含寻址：操作数存在专用寄存器中
2. 立即寻址：操作数在指令中体现
3. 直接寻址：指令中给出操作数地址
4. 间接寻址；操作数为以给出地址中存放数字为地址的数值
5. 寄存器寻址：操作数存放在某个寄存器当中。
6. 寄存器间接寻址：通过寄存器中保存的地址进行访问存储器获得数值
7. 偏移寻址：有效地址为形式地址加上偏移量
8. 段寻址；
9. 堆栈寻址，利用寄存器堆栈与存储器堆栈；

### 4.5 典型指令 ###

指令分类：

1. 数据传送指令
2. 算术运算指令
3. 逻辑运算指令
4. 程序控制指令：利用标志位进行跳转
5. 输入输出指令：启动外围指令，进行信息传送
6. 字符串处理指令；
7. 特权指令：具有特殊权限的指令
8. 其他指令。

**精简指令系统**

特点：选取使用频率最高的一些简单指令，指令条数少；指令长度固定，寻址方式种类少；只有取数/存数指令访问存储器，其他操作都在寄存器中进行。

### 4.6 ARM汇编语言 ###

----
## 第五章 CPU
### 5.1 CPU 的功能和组成
CPU完成的工作是将装入内存储器的程序，控制计算部件自动完成取指令和执行指令的任务。

基本功能四方面：
1. 指令控制
2. 操作控制
3. 时间控制
4. 数据加工

**由控制器和计算器组成，其中寄存器属于控制器部分**

**六大主要寄存器：DR、IR、PC、AR、R<sub>0</sub>-R<sub>3</sub>、PSW**

数据的流动由数据通路控制，通路之间的交互由操作控制器控制：硬布线控制器与微程序控制器，操作控制器的脉冲信号由时序产生器产生，除此外还有中断系统、总线接口等。

### 5.2 指令周期
几个重要的周期： **指令周期**：取出一个指令并执行这条指令的时间，用若干个 **CPU周期**　来表示，CPU周期又称　**机器周期**　，通常用内存读取一个指令字的最短时间来规定，　一个CPU周期包含若干个　**Ｔ周期**　处理操作的基本单位。　**时钟周期**　可以指CPU周期，也可以指主频分之一。

指令周期：取指周期大致相同，执行周期各不相同。

指令周期流程图，化简的原理与操作（微操作控制信号序列需要读取图上的控制信号）。
1. 总线上不产生冲突
2. 总时间不超过一个CPU周期。

### 5.3 时序产生器和控制方式

#### 时序信号产生器

硬布线控制器，时序信号采用主状态周期-节拍电位-节拍脉冲三级体制；微程序控制器中，只使用节拍电位-节拍脉冲二级体制。

1. 时钟源
2. 环形脉冲发生器
3. 节拍脉冲和存储器读/写时序
4. 启停控制逻辑

**控制方式**
1. 同步控制
2. 异步控制 —— 应答式
3. 联合控制

### 5.4 微程序控制器

**微命令与微操作**

由微命令与微操作组成的控制器。控制部件通过微命令通过控制线路控制执行部件执行微操作。执行部件向控制部件反馈操作情况，以根据执行部件状态下达新命令。

微操作分为相容性与相斥性两种。

**微指令与微程序**

一个CPU周期中，一组实现一定操作功能微命令的组合，构成一条微指令。

分为操作控制与顺序控制字段，顺序字段含有判别字段和下址字段。控制信号都是节拍电位信号，持续时间是一个CPU周期。

**微程序控制器**
控制存储器(CM)、微指令寄存器和地址转移逻辑。

**CPU周期与微指令周期的关系**
微指令周期等于读取指令加执行指令的时间，设计恰好与CPU周期重合一期。

**机器指令与微指令的关系**
一条机器指令对应一个微程序，由若干个微指令组成的序列相对应。机器指令所完成的操作分成若干微操作完成，由微指令解释和执行。

**设计**
1. 微命令编码：直接表示、编码表示、混合表示
2. 微地址形成：计数器方式、多路转移方式——设计时候为触发器强制端修改，注意！
3. 微指令格式：水平型微指令：并行操作，效率高，灵活性强，直接控制对象，速度快，设计困难；垂直型微指令：用较长的微程序来换取较短的微指令结构，需要译码，速度慢，可读性高，设计难度小。

### 5.5 硬布线控制器

**基本思想**
由门电路和触发器构成复杂树形逻辑网络，来控制控制信号。

单一控制信号为状态信号、节拍电位与节拍脉冲的组合。

**微操作控制信号的产生**

### 5.6 流水CPU

时间上并行或时空同时并行处理任务的CPU。 超标量流水CPU。

类似多模块交叉存储器的处理方式，时空图。

**流水线问题处理**

1. 资源相关 ：同时访问只提供一个端口的设备
2. 数据相关 ：出现“先读后写”的情况，导致数据出错
3. 控制相关 ：根据转移条件产生结果来取地址，会出现问题。延迟转移法；转移预测法。

### 5.7 RISC CPU

一定是流水CPU，使用等长指令，需要更快的执行速度。

与CISC的主要特征对比：

--------

## 第六章 总线系统 ##
### 6.1 总线的概念和结构形态

总线是构成计算机系统的互联结构，是多个系统功能部件之间进行数据传送的公共通路。CPU内部的总线称为内部总线；CPU与计算机系统其他部件互相连接的总线叫做_系统总线_

**总线的连接方式**

1. 单总线结构：将CPU、主存储器、其他I/O设备连接在一条总线上，对I/O设备的操作完全和主存的操作方式一样。单总线结构易拓展成多CPU结构。 _单总线只能分时工作，效率与吞吐量收到限制。_
2. 多总线结构：通过桥，CPU总线、系统总线和高速总线彼此相连。桥是一种具有缓冲、转换、控制功能的逻辑电路。

### 6.2 总线接口
信息传送方式：
1. 串行传送：只有一条传输线，且采用脉冲传送。位时间用同步脉冲来体现。 _优点_：只需要一条传输线，对长距离传输特别重要。
2. 并行传送：每个数据位对应一个传输线。一般采用电位传送。由于所有的位同时被传送，所以并行数据传送很快。
3. 分时传送：一是采用总线复用技术，划分时间间隔传送地址和传送数据；另一种是共享总线的部分分时使用总线。

**总线接口的基本概念**

I/O功能模块通常称为I/O接口，也叫适配器。外围设备本身带有自己的设备控制器，是控制外围设备进行操作的控制部件。

### 6.3 总线的仲裁
连接到总线的功能模块分为主方与从方两部分：主方可以提出总线请求，获得总线控制权，一次只能有一个主方占用总线；从方则只能响应主方的请求。 **主方持续控制总线的时间称为总线占用期。**

对多个设备提出的占用总线请求，一般采用优先级或公平策略进行仲裁。 _根据总线仲裁电路的位置不同，分为集中式仲裁与分布式仲裁_

#### 6.3.1集中式仲裁

集中式仲裁中每个功能模块都有两条线连到总线控制器：一条是送往仲裁器的总线请求信号线BR，一条是仲裁器送出的总线授权信号线BG。BS线为1时表示有设备控制总线，反之为空闲。

**链式查询方式**

查询链中离总线仲裁器最近的设备具有最高优先级，使用优先级队列来实现的。 _优点_：只用少量的线就能按照优先顺序实现总线仲裁，具有很容易扩充设备的特点； _缺点_：滴哦询问链的电路故障敏感。优先级固定，低优先级的部件很难获得总线控制权。

**计数器定时查询方式**

任一设备向仲裁器发送BR请求，在BS线是0的情况下，让计数器开始计数，计数值通过一组地址线发向个设备。每个设备接口都有一个设备地址判别电路，当计数值达到设备地址一致时，该设备置BS线为1，中止计数查询。 _优点_：具有一定的灵活性，使用额外的线来换取灵活性。

**独立请求方式**

每个设备都有自己的BG、BR线，当设备发出请求时，总线仲裁器中有一个排队电路，根据一定的优先次序决定首先响应哪个设备的请求，并发送BG信号。 _优点_：响应时间快，确定优先响应设备所花费的时间少，不需要依次查询。灵活性高。

#### 6.3.2 分布式仲裁

分布式仲裁不需要集中的总线仲裁器，每个潜在的主方设备都有自己的仲裁号与仲裁器。当有总线请求的时候，他们把唯一的仲裁号发往共享的仲裁总线上进行比较，获胜者的仲裁号留在仲裁总线上。

#### 6.4 总线的定时和数据传送模式

信息传送，五阶段：请求总线、总线仲裁、寻址、信息传送、状态返回。

定时方式：同步定时、异步定时

传送模式：读写操作、快传送操作（猝发式传送）、写后读读后写操作、广播广集操作

### 6.5 HOST总线和PCI总线

PCI总线：同步时序协议和集中式仲裁，具有自动配置能力，设备既可以是主设备，也可以是从设备。PCI没有DMA的概念。允许多条PCI总线的存在，使用HOST桥互联，也可以用PCI/PCI桥与已跟HOST桥相连的PCI总线相连。

隐藏式仲裁：不需要单独的仲裁总线周期。

-----
## 第7章 外存与I/O设备
### 7.1 概述

三部分组成：存储介质、驱动装置、控制电路。

分类：输入设备控制器、外存设备控制器、通信控制器、过程控制器、输出设备控制器。

### 7.2 磁盘存储设备

原理：磁表面存储、磁头

涉及计算：

柱面=道密度*有效存储区长度

每面信息量=内层位密度*内层磁道周长*柱面数

盘组总容量 = （2n-2）* 每面信息量

数据传输率 = rN
（r为磁盘转速，N为每条磁道容量）
记录格式
台号+柱面号（磁道号）+盘面号（磁头号）+扇区号

### 7.3 磁盘cache 磁盘阵列 RAID

### 7.4 磁带存储设备

D=dv d为记录密度，v为走带速度。

### 7.5 光盘和磁光盘存储设备

CD-ROM光盘：75扇区/秒、模式一程序和数据：2048B，模式二，声音、图像：2336B

### 7.6 显示设备
刷新存储器：M=rC
例：1024×1024分辨率，灰度256级，
1024×1024×8bit=1MB。

ASCII码：7位+1位校验

------

## 第8章 输入输出系统
### 8.1 外围设备的速度分级与信息交换方式
**速度分级大致分为三种情况：**
1. 速度极慢或简单的外围设备：CPU默认视为一直打开或关闭的状态；
2. 慢速或中速的外围设备：由于a这类设备的速度和CPU速度不在一个数量级，采用异步定时方式，常用的为应答式数据交换；
3. 高速的外围设备：这类设备是以相等的时间间隔来操作的，而CPU也是以等间隔的速率执行输入/输出指令的。采用同步定时方式。一旦CPU和外围设备同步，数据交换靠时钟脉冲来控制。

**信息交换方式：**

1. 程序查询方式：数据在CPU和外围设备之间的传送完全靠计算机控制完成。 _优点_：CPU和外围设备能够同步怒，结构简单；但是外围设备慢，程序进入查询阶段会康菲很多时间。
2. 程序中断方式：中断是外围设备来“主动”通知CPU，准备送出输入数据或接受输出数据的一种方法。程序中断后，CPU执行中断处理程序，中断处理完后，返回原来的任务。适用于一般适用于随机出现的服务。
3. 直接内存访问方式（DMA）：是一种完全由硬件执行I/O交换的工作方式。这种方式既考虑中断响应又要节约中断开销。DMA控制器从CPU完全接管对总线的控制，数据交换不经过CPU，而直接在内存和外围设备之间进行，以高速传送数据。
4. 通道方式：将CPU的权力下放给通道，输入输出处理器（IOP）对外围设备进行统一管理和数据传送。

### 8.2 程序查询方式
**设备编址**
使用两种编址方式。一种是统一编址，一种是独立编址。独立编址时还应有独立的I/O指令组
**输入/输出指令**

**程序查询方式的接口**
1. 设备选择电路：CPU执行I/O指令时需要把指令中设备地址送到地址总线上，是设备地址的译码器。
2. 数据缓冲寄存器：暂存数据，以便与外围设备I/O；
3. 设备状态标志：用来标志设备的状态，以便对外设动作进行监视。

**程序查询输入/输出方式**

1. 向IO设备放出命令字，请求数据传送；
2. 从IO接口读入状态字；
3. 检查状态字中的标志，判断数据交换是否可以进行
4. 没有准备就绪则重复2，3，直到发出准备就绪信号
5. CPU从I/O接口的数据缓冲寄存器输入数据，或从CPU输出到接口的数据缓冲寄存器。标志位复位。


 ### 8.3 程序中断方式
**中断的基本概念**
执行指令时，发现中断-是否响应中断-中断周期（硬件）-中断服务子程序（软件）

中断方式的基本I/O接口，准备就绪标志（RD），允许中断触发器（EL），中断请求触发器（IR），中断屏蔽触发器（IM），

**确定中断源**
一维：串行排队链法：产生中断源的地址
多维情况：多级中断
独立请求方式的优先排队逻辑。

### 8.4 DMA方式

直接内存访问方式。速度快。
操作：
1. 从外围设备发出DMA请求；
2. CPU响应请求，CPU工作改为DMA操作方式，DMA控制器接管总线
3. 由DMA执行数据块传送操作。
4. 向CPU报告DMA操作的结束

**DMA传送方式**

由于DMA需要直接访问内存，CPU需要与其配合：
1. 停止CPU访问内存
2. 周期挪用
3. DMA与CPU交替访内

**DMA控制器**

内存地址计数器，字计数器，数据缓冲寄存器，DMA请求标志，控制/状态逻辑，中断机构。

**DMA分类**

1. 选择型DMA控制器：物理上连接多个设备，同一时刻一个设备工作，适用于快速设备
2. 多路型DMA控制器：物理上逻辑上连接多个设备，各设备以字节交叉方式进行传送。
